Some C++ templates black magic.
